#!/usr/bin/env node
function e(){if(te)return re;te=1;const e=a();return re=(r,t,n)=>{const o=new e(r,n),s=new e(t,n);return o.compare(s)||o.compareBuild(s)}}function r(){if(we)return ge;we=1;const e=a(),r=u(),{ANY:t}=r,n=c(),o=p(),s=l(),i=f(),v=m(),d=h();return ge=(a,c,l,u)=>{let p,f,m,h,g;switch(a=new e(a,u),c=new n(c,u),l){case">":p=s,f=v,m=i,h=">",g=">=";break;case"<":p=i,f=d,m=s,h="<",g="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(a,c,u))return!1;for(let e=0;c.set.length>e;++e){let n=null,o=null;if(c.set[e].forEach((e=>{e.semver===t&&(e=new r(">=0.0.0")),n=n||e,o=o||e,p(e.semver,n.semver,u)?n=e:m(e.semver,o.semver,u)&&(o=e)})),n.operator===h||n.operator===g)return!1;if((!o.operator||o.operator===h)&&f(a,o.semver))return!1;if(o.operator===g&&m(a,o.semver))return!1}return!0}}function t(){if(Ae)return Oe;Ae=1;const t=v(),n=S(),o=a(),j=E(),_=s(),x=d(),C=function(){if(Y)return B;Y=1;const e=s();return B=(r,t)=>{const n=e(r.trim().replace(/^[=v]+/,""),t);return n?n.version:null}}(),N=function(){if(L)return G;L=1;const e=a();return G=(r,t,n,o,s)=>{"string"==typeof n&&(s=o,o=n,n=void 0);try{return new e(r instanceof e?r.version:r,n).inc(t,o,s).version}catch(a){return null}}}(),O=function(){if(D)return q;D=1;const e=s();return q=(r,t)=>{const n=e(r,null,!0),o=e(t,null,!0),s=n.compare(o);if(0===s)return null;const a=s>0,i=a?n:o,c=a?o:n,l=!!i.prerelease.length;if(c.prerelease.length&&!l){if(!c.patch&&!c.minor)return"major";if(0===c.compareMain(i))return c.minor&&!c.patch?"minor":"patch"}const u=l?"pre":"";return n.major!==o.major?u+"major":n.minor!==o.minor?u+"minor":n.patch!==o.patch?u+"patch":"prerelease"}}(),A=g(),T=function(){if(H)return F;H=1;const e=a();return F=(r,t)=>new e(r,t).minor}(),I=function(){if(W)return J;W=1;const e=a();return J=(r,t)=>new e(r,t).patch}(),R=function(){if(X)return $;X=1;const e=s();return $=(r,t)=>{const n=e(r,t);return n&&n.prerelease.length?n.prerelease:null}}(),P=i(),M=function(){if(Q)return K;Q=1;const e=i();return K=(r,t,n)=>e(t,r,n)}(),U=function(){if(ee)return Z;ee=1;const e=i();return Z=(r,t)=>e(r,t,!0)}(),z=e(),V=function(){if(oe)return ne;oe=1;const r=e();return ne=(e,t)=>e.sort(((e,n)=>r(e,n,t)))}(),re=function(){if(ae)return se;ae=1;const r=e();return se=(e,t)=>e.sort(((e,n)=>r(n,e,t)))}(),te=l(),ge=f(),we=w(),Te=y(),Ie=h(),Re=m(),Pe=b(),Me=k(),Ue=u(),ze=c(),Ve=p(),Be=function(){if(ce)return ie;ce=1;const e=c();return ie=(r,t)=>new e(r,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))}(),Ye=function(){if(ue)return le;ue=1;const e=a(),r=c();return le=(t,n,o)=>{let s=null,a=null,i=null;try{i=new r(n,o)}catch(c){return null}return t.forEach((r=>{i.test(r)&&(s&&-1!==a.compare(r)||(s=r,a=new e(s,o)))})),s}}(),Ge=function(){if(fe)return pe;fe=1;const e=a(),r=c();return pe=(t,n,o)=>{let s=null,a=null,i=null;try{i=new r(n,o)}catch(c){return null}return t.forEach((r=>{i.test(r)&&(s&&1!==a.compare(r)||(s=r,a=new e(s,o)))})),s}}(),Le=function(){if(he)return me;he=1;const e=a(),r=c(),t=l();return me=(n,o)=>{n=new r(n,o);let s=new e("0.0.0");if(n.test(s))return s;if(s=new e("0.0.0-0"),n.test(s))return s;s=null;for(let r=0;n.set.length>r;++r){let o=null;n.set[r].forEach((r=>{const n=new e(r.semver.version);switch(r.operator){case">":0===n.prerelease.length?n.patch++:n.prerelease.push(0),n.raw=n.format();case"":case">=":o&&!t(n,o)||(o=n);break;case"<":case"<=":break;default:throw Error("Unexpected operation: "+r.operator)}})),!o||s&&!t(s,o)||(s=o)}return s&&n.test(s)?s:null}}(),qe=function(){if(de)return ve;de=1;const e=c();return ve=(r,t)=>{try{return new e(r,t).range||"*"}catch(n){return null}}}(),De=r(),Fe=function(){if(be)return ye;be=1;const e=r();return ye=(r,t,n)=>e(r,t,">",n)}(),He=function(){if(Ee)return ke;Ee=1;const e=r();return ke=(r,t,n)=>e(r,t,"<",n)}(),Je=function(){if(je)return Se;je=1;const e=c();return Se=(r,t,n)=>(r=new e(r,n),t=new e(t,n),r.intersects(t,n))}(),We=function(){if(xe)return _e;xe=1;const e=p(),r=i();return _e=(t,n,o)=>{const s=[];let a=null,i=null;const c=t.sort(((e,t)=>r(e,t,o)));for(const r of c)e(r,n,o)?(i=r,a||(a=r)):(i&&s.push([a,i]),i=null,a=null);a&&s.push([a,null]);const l=[];for(const[e,r]of s)l.push(e===r?e:r||e!==c[0]?r?e===c[0]?"<="+r:`${e} - ${r}`:">="+e:"*");const u=l.join(" || ");return("string"==typeof n.raw?n.raw:n+"").length>u.length?u:n}}(),$e=function(){if(Ne)return Ce;Ne=1;const e=c(),r=u(),{ANY:t}=r,n=p(),o=i(),s=[new r(">=0.0.0-0")],a=[new r(">=0.0.0")],l=(e,r,i)=>{if(e===r)return!0;if(1===e.length&&e[0].semver===t){if(1===r.length&&r[0].semver===t)return!0;e=i.includePrerelease?s:a}if(1===r.length&&r[0].semver===t){if(i.includePrerelease)return!0;r=a}const c=new Set;let l,u,p,h,v,d,g;for(const t of e)">"===t.operator||">="===t.operator?l=f(l,t,i):"<"===t.operator||"<="===t.operator?u=m(u,t,i):c.add(t.semver);if(c.size>1)return null;if(l&&u){if(p=o(l.semver,u.semver,i),p>0)return null;if(0===p&&(">="!==l.operator||"<="!==u.operator))return null}for(const t of c){if(l&&!n(t,l+"",i))return null;if(u&&!n(t,u+"",i))return null;for(const e of r)if(!n(t,e+"",i))return!1;return!0}let w=!(!u||i.includePrerelease||!u.semver.prerelease.length)&&u.semver,y=!(!l||i.includePrerelease||!l.semver.prerelease.length)&&l.semver;w&&1===w.prerelease.length&&"<"===u.operator&&0===w.prerelease[0]&&(w=!1);for(const t of r){if(g=g||">"===t.operator||">="===t.operator,d=d||"<"===t.operator||"<="===t.operator,l)if(y&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===y.major&&t.semver.minor===y.minor&&t.semver.patch===y.patch&&(y=!1),">"===t.operator||">="===t.operator){if(h=f(l,t,i),h===t&&h!==l)return!1}else if(">="===l.operator&&!n(l.semver,t+"",i))return!1;if(u)if(w&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===w.major&&t.semver.minor===w.minor&&t.semver.patch===w.patch&&(w=!1),"<"===t.operator||"<="===t.operator){if(v=m(u,t,i),v===t&&v!==u)return!1}else if("<="===u.operator&&!n(u.semver,t+"",i))return!1;if(!t.operator&&(u||l)&&0!==p)return!1}return!(l&&d&&!u&&0!==p||u&&g&&!l&&0!==p||y||w)},f=(e,r,t)=>{if(!e)return r;const n=o(e.semver,r.semver,t);return n>0?e:0>n||">"===r.operator&&">="===e.operator?r:e},m=(e,r,t)=>{if(!e)return r;const n=o(e.semver,r.semver,t);return 0>n?e:n>0||"<"===r.operator&&"<="===e.operator?r:e};return Ce=(r,t,n={})=>{if(r===t)return!0;r=new e(r,n),t=new e(t,n);let o=!1;e:for(const e of r.set){for(const r of t.set){const t=l(e,r,n);if(o=o||null!==t,t)continue e}if(o)return!1}return!0}}();return Oe={parse:_,valid:x,clean:C,inc:N,diff:O,major:A,minor:T,patch:I,prerelease:R,compare:P,rcompare:M,compareLoose:U,compareBuild:z,sort:V,rsort:re,gt:te,lt:ge,eq:we,neq:Te,gte:Ie,lte:Re,cmp:Pe,coerce:Me,Comparator:Ue,Range:ze,satisfies:Ve,toComparators:Be,maxSatisfying:Ye,minSatisfying:Ge,minVersion:Le,validRange:qe,outside:De,gtr:Fe,ltr:He,intersects:Je,simplifyRange:We,subset:$e,SemVer:o,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:j.compareIdentifiers,rcompareIdentifiers:j.rcompareIdentifiers}}function n(e){return null==e?[]:Array.isArray(e)?e:[e]}function o(e,r,t,n){var o,s=e[r],a=~n.string.indexOf(r)?null==t||!0===t?"":t+"":"boolean"==typeof t?t:~n.boolean.indexOf(r)?"false"!==t&&("true"===t||(e._.push(0*(o=+t)==0?o:t),!!t)):0*(o=+t)==0?o:t;e[r]=null==s?a:Array.isArray(s)?s.concat(a):[s,a]}import{r as s,a,b as i,c,d as l,e as u,f as p,g as f,h as m,i as h,j as v,k as d,l as g,m as w,n as y,o as b,p as k,q as E,s as S,t as j,u as _,w as x,v as C,x as N,y as O,z as A,A as T,B as I,C as R}from"./lib.mjs";import P from"process";import M from"os";import U from"path";import z from"fs";import V from"https";import"crypto";import"net";import"tls";import"http";import"events";import"util";import"string_decoder";import"child_process";import"timers";import"buffer";import"stream";import"constants";import"assert";import"node:buffer";import"node:path";import"node:child_process";import"node:process";import"node:url";import"node:os";import"node:fs";import"node:util";import"fs/promises";import"url";import"console";var B,Y,G,L,q,D,F,H,J,W,$,X,K,Q,Z,ee,re,te,ne,oe,se,ae,ie,ce,le,ue,pe,fe,me,he,ve,de,ge,we,ye,be,ke,Ee,Se,je,_e,xe,Ce,Ne,Oe,Ae,Te,Ie;const Re=j(function(){function e(e,r,t,n){return new(t||(t=Promise))((function(r,o){function s(e){try{i(n.next(e))}catch(r){o(r)}}function a(e){try{i(n.throw(e))}catch(r){o(r)}}function i(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}i((n=n.call(e)).next())}))}function r(e,r){function t(t){return function(c){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,t[0]&&(i=0)),i;)try{if(n=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,o=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==t[0]&&2!==t[0])){i=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&s[3]>t[1])){i.label=t[1];break}if(6===t[0]&&s[1]>i.label){i.label=s[1],s=t;break}if(s&&s[2]>i.label){i.label=s[2],i.ops.push(t);break}s[2]&&i.ops.pop(),i.trys.pop();continue}t=r.call(e,i)}catch(c){t=[6,c],o=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,c])}}var n,o,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}if(Ie)return Te;Ie=1;var n=P,o=t(),s=M,a=U,i=z,c=V,l=n.env.npm_package_json,u=n.env.npm_config_user_agent,p=!(!u||!u.startsWith("npm")),f=!(!l||!l.endsWith("package.json")),m=p||f,h=!(!u||!u.startsWith("yarn")),v=m||h,d=s.homedir(),g=process.env.XDG_CONFIG_HOME||a.join(d,".config","simple-update-notifier"),w=function(e){return a.join(g,"".concat(e.replace("@","").replace("/","__"),".json"))},y=function(t,n){return e(void 0,0,void 0,(function(){var e;return r(this,(function(r){return e="https://registry.npmjs.org/-/package/".concat(t,"/dist-tags"),[2,new Promise((function(r,t){c.get(e,(function(e){var o="";e.on("data",(function(e){return o+=e})),e.on("end",(function(){try{var e=JSON.parse(o)[n];e||t(Error("Error getting version")),r(e)}catch(s){t(Error("Could not parse version response"))}}))})).on("error",(function(e){return t(e)}))}))]}))}))},b=function(t){var n=t.pkg,s=t.updateCheckInterval,a=void 0===s?864e5:s,c=t.distTag,l=void 0===c?"latest":c,u=t.alwaysRun,p=t.debug;return e(void 0,0,void 0,(function(){var e,s;return r(this,(function(r){switch(r.label){case 0:return i.existsSync(g)||i.mkdirSync(g,{recursive:!0}),e=function(e){var r=w(e);try{if(!i.existsSync(r))return;return JSON.parse(i.readFileSync(r,"utf8")).lastUpdateCheck}catch(t){return}}(n.name),u||!e||e<(new Date).getTime()-a?[4,y(n.name,l)]:[3,2];case 1:return s=r.sent(),c=w(n.name),i.writeFileSync(c,JSON.stringify({lastUpdateCheck:(new Date).getTime()})),o.gt(s,n.version)?[2,s]:(p&&console.error("Latest version (".concat(s,") not newer than current version (").concat(n.version,")")),[3,3]);case 2:p&&console.error("Too recent to check for a new update. simpleUpdateNotifier() interval set to ".concat(a,"ms but only ").concat((new Date).getTime()-e,"ms since last check.")),r.label=3;case 3:return[2,!1]}var c}))}))};return Te=function(t){return e(void 0,0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:if(!t.alwaysRun&&(!process.stdout.isTTY||v&&!t.shouldNotifyInNpmScript))return t.debug&&console.error("Opting out of running simpleUpdateNotifier()"),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,b(t)];case 2:return(e=r.sent())&&console.error(function(e){for(var r=e.split("\n"),t=Math.max.apply(Math,r.map((function(e){return e.length}))),n=["┌".concat("─".repeat(t+2),"┐")],o=0,s=r;s.length>o;o++)n.push("│ ".concat(s[o].padEnd(t)," │"));return n.push("└".concat("─".repeat(t+2),"┘")),n.join("\n")}("New version of ".concat(t.pkg.name," available!\nCurrent Version: ").concat(t.pkg.version,"\nLatest Version: ").concat(e))),[3,4];case 3:return n=r.sent(),t.debug&&n instanceof Error&&console.error("Unexpected error in simpleUpdateNotifier():",n),[3,4];case 4:return[2]}}))}))}}());(async function(e){const r=T.GITHUB_ACTIONS?Promise.resolve():async function(){try{await Re({pkg:_})}catch(e){x("Failed to check for updates: "+(e instanceof Error?e.message+e.stack:e))}}(),t=function(e){const r=Object.fromEntries(C.map((e=>[e,N(e)])));return function(e,r){var t,s,a,i,c,l={_:[]},u=0,p=0,f=0,m=(e=e||[]).length;const h=void 0!==(r=r||{}).alias,v=void 0!==r.unknown,d=void 0!==r.default;if(r.alias=r.alias||{},r.string=n(r.string),r.boolean=n(r.boolean),h)for(t in r.alias)for(s=r.alias[t]=n(r.alias[t]),u=0;s.length>u;u++)(r.alias[s[u]]=s.concat(t)).splice(u,1);for(u=r.boolean.length;u-- >0;)for(p=(s=r.alias[r.boolean[u]]||[]).length;p-- >0;)r.boolean.push(s[p]);for(u=r.string.length;u-- >0;)for(p=(s=r.alias[r.string[u]]||[]).length;p-- >0;)r.string.push(s[p]);if(d)for(t in r.default)if(i=typeof r.default[t],s=r.alias[t]=r.alias[t]||[],void 0!==r[i])for(r[i].push(t),u=0;s.length>u;u++)r[i].push(s[u]);const g=v?Object.keys(r.alias):[];for(u=0;m>u;u++){if("--"===(a=e[u])){l._=l._.concat(e.slice(++u));break}for(p=0;a.length>p&&45===a.charCodeAt(p);p++);if(0===p)l._.push(a);else if("no-"===a.substring(p,p+3)){if(i=a.substring(p+3),v&&!~g.indexOf(i))return r.unknown(a);l[i]=!1}else{for(f=p+1;a.length>f&&61!==a.charCodeAt(f);f++);for(i=a.substring(p,f),c=a.substring(++f)||u+1===m||45===(""+e[u+1]).charCodeAt(0)||e[++u],s=2===p?[i]:i,f=0;s.length>f;f++){if(i=s[f],v&&!~g.indexOf(i))return r.unknown("-".repeat(p)+i);o(l,i,s.length>f+1||c,r)}}}if(d)for(t in r.default)void 0===l[t]&&(l[t]=r.default[t]);if(h)for(t in l)for(s=r.alias[t]||[];s.length>0;)l[s.shift()]=l[t];return l}(e,{string:[...C,"timeout","node-package-manager"],default:r,alias:{h:"help",v:"version"},boolean:["help","version","setup-cpp"]})}(e);if(t.help)return O('\nsetup-cpp [options]\nsetup-cpp --compiler llvm --cmake true --ninja true --ccache true --vcpkg true\n\nInstall all the tools required for building and testing C++/C projects.\n\n--architecture\t the cpu architecture to install the tools for. By default it uses the current CPU architecture.\n--timeout\t the timeout for the installation of each tool in minutes. By default it is 10 minutes.\n--compiler\t the <compiler> to install.\n          \t You can specify the version instead of specifying just the name e.g: --compiler \'llvm-13.0.0\'\n--tool_name\t pass "true" or pass the <version> you would like to install for this tool. e.g. --conan true or --conan "1.42.1"\n--nodePackageManager\t the node package manager to use (npm/yarn/pnpm) when installing setup-cpp globally\n--help\t show this help message\n--version\t show the version of setup-cpp\n\nAll the available tools:\n'),console.table({"compiler and analyzer":{tools:"--llvm, --gcc, --msvc, --apple-clang, --vcvarsall"},"build system":{tools:"--cmake, --ninja, --meson, --make, --task, --bazel"},"package manager":{tools:"--vcpkg, --conan, --choco, --brew, --nala, --git, --setup-cpp"},"analyzer/linter":{tools:"--clang-tidy, --clang-format, --cppcheck, --cpplint, --flawfinder, --lizard, --infer, , --cmakelang, --cmake-lint, --cmake-format"},cache:{tools:"--ccache, --sccache"},documentation:{tools:"--doxygen, --graphviz"},coverage:{tools:"--gcovr, --opencppcoverage, --kcov"},other:{tools:"--python, --powershell, --sevenzip"}},["tools"]),0;if(t.version)return O(""+_.version),0;const{successMessages:s,errorMessages:a}=await I(t);for(const n of s)R(n);for(const n of a)A(n);if((0!==s.length||0!==a.length)&&(O("setup-cpp finished"),!T.GITHUB_ACTIONS))switch(process.platform){case"win32":x("Run `RefreshEnv.cmd` or restart your shell to update the environment.");break;case"linux":case"darwin":x("Run `source ~/.cpprc` or restart your shell to update the environment.")}return await r,0})(process.argv).then((e=>{process.exitCode=e})).catch((e=>{A("main() panicked!"),A(e),process.exitCode=1}));export{t as r};
//# sourceMappingURL=setup-cpp.mjs.map
